#! /usr/bin/env bash
set -euo pipefail

scriptDir=$(dirname "$0")
nixDir="$scriptDir/../nix"

nix build -f $nixDir --no-link "$@"

for package in "$@"; do
  for b in $(ls $(nix path-info -f $nixDir $package)/bin); do
    cat << EOF > "$scriptDir/$b"
#! /usr/bin/env bash
# This file was generated by $(basename "$0")
exec nix run -f "\$(dirname "\$0")/../nix" $package --command $b "\$@"
EOF
  chmod +x "$scriptDir/$b"
  done
done

